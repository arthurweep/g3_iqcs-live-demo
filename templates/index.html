<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>智能玻璃质检系统 (IQCS)</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background: #f4f7f6; color: #333; margin: 2em;}
        .flash-message { padding: 1em; margin-bottom: 1em; border-radius: 8px; border: 1px solid transparent; }
        .flash-success { background-color: #d1e7dd; color: #0f5132; border-color: #badbcc; }
        .flash-error { background-color: #f8d7da; color: #842029; border-color: #f5c2c7; }
    </style>
</head>
<body>
    <h1>智能玻璃质检系统 (IQCS)</h1>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for c, m in messages %}
          <div class="flash-message flash-{{ c }}">{{ m }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    <div>
        <h2>上传数据并训练模型</h2>
        <form action="/train" method="post" enctype="multipart/form-data">
            <input type="file" name="file" required>
            <button type="submit">上传并开始训练</button>
        </form>
    </div>
    {% if model_ready %}
    <div>
        <h2>训练结果</h2>
        <p>文件名: {{ cache.filename }}</p>
        <img src="data:image/png;base64,{{ cache.feature_plot }}" alt="特征重要性" style="max-width: 600px;">
        <table border="1" cellpadding="5">
            <tr><th>准确率</th><td>{{ "%.2f%%"|format(cache.metrics.accuracy*100) }}</td></tr>
            <tr><th>不合格品召回率</th><td>{{ "%.2f%%"|format(cache.metrics.recall_ng*100) }}</td></tr>
            <tr><th>不合格品精确率</th><td>{{ "%.2f%%"|format(cache.metrics.precision_ng*100) }}</td></tr>
            <tr><th>不合格品F1分数</th><td>{{ "%.3f"|format(cache.metrics.f1_ng) }}</td></tr>
        </table>
    </div>
    {% endif %}
</body>
</html>
